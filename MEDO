<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç·šä¸Šåœ–é‘‘é›»å­æ›¸</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; align-items: center; background: #f9f9f9; margin: 0; padding: 20px; }
    .card { text-align: center; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin-bottom: 20px; }
    img { width: 250px; height: 250px; object-fit: cover; border-radius: 10px; }
    h2 { margin: 15px 0 10px; color: #333; }
    p { color: #555; }
    .buttons { margin-top: 20px; }
    button { padding: 8px 16px; margin: 5px; border: none; border-radius: 8px; background: #4CAF50; color: white; cursor: pointer; }
    button:hover { background: #45a049; }
    .danger { background: #d9534f; }
    .danger:hover { background: #c9302c; }
    .form { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin-top: 20px; }
    input, textarea { width: 100%; margin: 5px 0; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    .search-box { margin: 15px 0; text-align: center; }
    select { padding: 6px; border-radius: 6px; border: 1px solid #ccc; margin-top: 15px; }
  </style>
</head>
<body>

  <div class="card">
    <img id="image" src="" alt="åœ–ç‰‡">
    <h2 id="title"></h2>
    <p id="description"></p>
    <div class="buttons">
      <button onclick="prevPage()">ä¸Šä¸€é </button>
      <button onclick="nextPage()">ä¸‹ä¸€é </button>
      <button onclick="editEntry()">ä¿®æ”¹</button>
      <button class="danger" onclick="deleteEntry()">åˆªé™¤</button>
      <button onclick="randomEntry()">ğŸ² æŠ½ç±¤</button>
    </div>
  </div>

  <!-- æœå°‹åŠŸèƒ½ -->
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="è¼¸å…¥åç¨±æœå°‹">
    <button onclick="searchEntry()">æœå°‹</button>
  </div>

  <!-- ä¸‹æ‹‰é¸å–® -->
  <div>
    <label for="dropdown">å¿«é€Ÿè·³è½‰ï¼š</label>
    <select id="dropdown" onchange="jumpToEntry()">
      <option value="">è«‹é¸æ“‡åœ–é‘‘</option>
    </select>
  </div>

  <!-- æ–°å¢/ä¿®æ”¹è¡¨å–® -->
  <div class="form">
    <h3 id="formTitle">æ–°å¢ / ä¿®æ”¹ åœ–é‘‘</h3>
    <input type="text" id="name" placeholder="åç¨±">
    <textarea id="desc" placeholder="èªªæ˜"></textarea>
    <input type="file" id="imgInput" accept="image/*">
    <button onclick="saveEntry()">å„²å­˜</button>
  </div>

  <script>
    let encyclopedia = JSON.parse(localStorage.getItem("encyclopedia")) || [];
    let index = 0;
    let editing = false; // æ˜¯å¦åœ¨ä¿®æ”¹æ¨¡å¼

    function showPage() {
      if (encyclopedia.length === 0) {
        document.getElementById("title").innerText = "ï¼ˆç›®å‰æ²’æœ‰è³‡æ–™ï¼‰";
        document.getElementById("description").innerText = "";
        document.getElementById("image").src = "";
        updateDropdown();
        return;
      }
      const item = encyclopedia[index];
      document.getElementById("title").innerText = item.name;
      document.getElementById("description").innerText = item.description;
      document.getElementById("image").src = item.image;
      updateDropdown();
    }

    function nextPage() {
      if (index < encyclopedia.length - 1) {
        index++;
        showPage();
      }
    }

    function prevPage() {
      if (index > 0) {
        index--;
        showPage();
      }
    }

    function saveEntry() {
      const name = document.getElementById("name").value;
      const desc = document.getElementById("desc").value;
      const file = document.getElementById("imgInput").files[0];

      if (!name || !desc) {
        alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™ï¼");
        return;
      }

      if (editing) {
        // ä¿®æ”¹æ¨¡å¼
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            encyclopedia[index] = { name: name, description: desc, image: e.target.result };
            localStorage.setItem("encyclopedia", JSON.stringify(encyclopedia));
            showPage();
            resetForm();
          };
          reader.readAsDataURL(file);
        } else {
          encyclopedia[index].name = name;
          encyclopedia[index].description = desc;
          localStorage.setItem("encyclopedia", JSON.stringify(encyclopedia));
          showPage();
          resetForm();
        }
      } else {
        // æ–°å¢æ¨¡å¼
        if (!file) {
          alert("è«‹é¸æ“‡åœ–ç‰‡ï¼");
          return;
        }
        const reader = new FileReader();
        reader.onload = function(e) {
          encyclopedia.push({ name: name, description: desc, image: e.target.result });
          localStorage.setItem("encyclopedia", JSON.stringify(encyclopedia));
          index = encyclopedia.length - 1;
          showPage();
          resetForm();
        };
        reader.readAsDataURL(file);
      }
    }

    function editEntry() {
      if (encyclopedia.length === 0) return;
      const item = encyclopedia[index];
      document.getElementById("name").value = item.name;
      document.getElementById("desc").value = item.description;
      document.getElementById("formTitle").innerText = "ä¿®æ”¹åœ–é‘‘";
      editing = true;
    }

    function deleteEntry() {
      if (encyclopedia.length === 0) return;
      if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹åœ–é‘‘å—ï¼Ÿ")) return;
      encyclopedia.splice(index, 1);
      localStorage.setItem("encyclopedia", JSON.stringify(encyclopedia));
      if (index > 0) index--;
      showPage();
    }

    function resetForm() {
      document.getElementById("name").value = "";
      document.getElementById("desc").value = "";
      document.getElementById("imgInput").value = "";
      document.getElementById("formTitle").innerText = "æ–°å¢ / ä¿®æ”¹ åœ–é‘‘";
      editing = false;
    }

    function searchEntry() {
      const keyword = document.getElementById("searchInput").value.trim();
      if (!keyword) {
        alert("è«‹è¼¸å…¥åç¨±");
        return;
      }
      const foundIndex = encyclopedia.findIndex(item => item.name.includes(keyword)); // æ¨¡ç³Šæœå°‹
      if (foundIndex !== -1) {
        index = foundIndex;
        showPage();
      } else {
        alert("æ‰¾ä¸åˆ°è©²åç¨±çš„åœ–é‘‘");
      }
    }

    function updateDropdown() {
      const dropdown = document.getElementById("dropdown");
      dropdown.innerHTML = '<option value="">è«‹é¸æ“‡åœ–é‘‘</option>';
      encyclopedia.forEach((item, i) => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = item.name;
        if (i === index) option.selected = true;
        dropdown.appendChild(option);
      });
    }

    function jumpToEntry() {
      const dropdown = document.getElementById("dropdown");
      if (dropdown.value !== "") {
        index = parseInt(dropdown.value);
        showPage();
      }
    }

    function randomEntry() {
      if (encyclopedia.length === 0) return;
      index = Math.floor(Math.random() * encyclopedia.length);
      showPage();
      alert("ğŸ² æŠ½ä¸­äº†ï¼šã€Œ" + encyclopedia[index].name + "ã€ï¼");
    }

    showPage();
  </script>

</body>
</html>
